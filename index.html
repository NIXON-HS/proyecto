<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jugador.java</title>
    <style>
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, "Courier New", monospace;
        }
    </style>
</head>
<body>
    <h1>Jugador.java</h1>
    <pre><code>
package com.proyecto;

public class Jugador {
    String nombre;
    String teclaAceptación;
    String teclaRechazo;
    double puntuacion;
    double tiempo;

    public Jugador(String nombre, String teclaAceptación, String teclaRechazo) {
        this.nombre = nombre;
        this.teclaAceptación = teclaAceptación;
        this.teclaRechazo = teclaRechazo;
        this.puntuacion = 0;
        this.tiempo = 0;
    }

    @Override
    public String toString() {
        return "Nombre: " + nombre + ", Tecla de Aceptación: " + teclaAceptación + ", Tecla de Rechazo: " + teclaRechazo;
    }

    public void sumarTiempo(double tiempo) {
        this.tiempo += tiempo;
    }

    public void puntuar(double puntos) {
        this.puntuacion += puntos;
    }
}
    </code></pre>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego.java</title>
    <style>
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, "Courier New", monospace;
        }
    </style>
</head>
<body>
    <h1>Juego.java</h1>
    <pre><code>
package com.proyecto;

import java.util.LinkedList;
import java.util.Random;
import javax.swing.JOptionPane;

public class Juego {
    public LinkedList<Jugador> jugadores; // Lista de los jugadores registrados
    public LinkedList<Jugador> jugadoresSobrantes; // Jugadores que están jugando y que se van eliminando
    public LinkedList<String> frase; // Lista que almacena las palabras de la frase

    public Juego() {
        this.jugadores = new LinkedList<>();
        this.frase = new LinkedList<>();
    }

    // Agrega un jugador a la lista de jugadores registrados
    public boolean agregarJugador(Jugador jugador) {
        return this.jugadores.add(jugador);
    }

    // Cambia el orden de los jugadores a un orden aleatorio
    public void elegirOrden() {
        int n = this.jugadores.size();
        Random random = new Random();
        for (int i = 0; i < n; i++) {
            int change = i + random.nextInt(n - i);
            cambiar(i, change);
        }
        this.jugadoresSobrantes = new LinkedList<>(this.jugadores);
    }

    // Se utiliza en el método `elegirOrden`, intercambia las posiciones de los
    // jugadores
    public void cambiar(int i, int change) {
        Jugador helper = this.jugadores.get(i);
        this.jugadores.set(i, this.jugadores.get(change));
        this.jugadores.set(change, helper);
    }

    // Imprime todos los jugadores registrados
    public void imprimirJugadores() {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < jugadores.size(); i++) {
            Jugador jugador = jugadores.get(i);
            sb.append((i + 1) + ". Nombre: " + jugador.nombre + ", Tecla de Aceptación: " + jugador.teclaAceptación
                    + ", Tecla de Rechazo: " + jugador.teclaRechazo + "\n");
        }
        JOptionPane.showMessageDialog(null, sb.toString(), "Jugadores Registrados", JOptionPane.INFORMATION_MESSAGE);
    }

    // Inicializa la lista frase para guardar las palabras, todavía está en
    // construcción
    public void iniciarJuego() {
        this.frase = new LinkedList<>();
        LinkedList<Jugador> eliminados = new LinkedList<>();
        JOptionPane.showMessageDialog(null, "El juego ha comenzado!", "Inicio del Juego",
                JOptionPane.INFORMATION_MESSAGE);
        elegirOrden(); // Ensure players are in a random order
        StringBuilder mensaje = new StringBuilder("Orden de los jugadores:\n");
        for (int i = 0; i < jugadores.size(); i++) {
            Jugador jugador = jugadores.get(i);
            mensaje.append((i + 1) + ". Nombre: " + jugador.nombre + ", Tecla de Aceptación: " + jugador.teclaAceptación
                    + ", Tecla de Rechazo: " + jugador.teclaRechazo + "\n");
        }
        JOptionPane.showMessageDialog(null, mensaje.toString(), "Orden de los Jugadores",
                JOptionPane.INFORMATION_MESSAGE);

        // Start the game loop
        while (jugadoresSobrantes.size() > 1) {
            for (int i = 0; i < jugadoresSobrantes.size(); i++) {
                Jugador jugador = jugadoresSobrantes.get(i);
                JOptionPane.showMessageDialog(null, "Es el turno de " + jugador.nombre, "Turno del Jugador",
                        JOptionPane.INFORMATION_MESSAGE);
                JOptionPane.showMessageDialog(null, "Frase actual: " + String.join(" ", frase), "Frase Actual",
                        JOptionPane.INFORMATION_MESSAGE);

                long startTime = System.currentTimeMillis(); // Start timing
                String input = JOptionPane.showInputDialog("Ingrese la frase:");
                long endTime = System.currentTimeMillis(); // End timing

                double timeTaken = (endTime - startTime) / 1000.0; // Time in seconds
                jugador.sumarTiempo(timeTaken);

                String[] palabras = input.split(" ");
                boolean error = comprobarError(palabras, i);

                // Calificación por otros jugadores
                for (int j = 0; j < jugadoresSobrantes.size(); j++) {
                    if (j != i) {
                        Jugador calificador = jugadoresSobrantes.get(j);
                        String decision;
                        do {
                            decision = JOptionPane.showInputDialog(
                                    calificador.nombre + " está calificando la frase de " + jugador.nombre
                                            + "\nTecla de aceptación: " + calificador.teclaAceptación
                                            + ", Tecla de rechazo: " + calificador.teclaRechazo
                                            + "\n¿La frase es correcta? (aceptar/rechazar): ");
                            if (!decision.equalsIgnoreCase(calificador.teclaAceptación)
                                    && !decision.equalsIgnoreCase(calificador.teclaRechazo)) {
                                JOptionPane.showMessageDialog(null,
                                        "Entrada inválida. Por favor, ingrese solo la tecla de aceptación o rechazo.",
                                        "Advertencia", JOptionPane.WARNING_MESSAGE);
                            }
                        } while (!decision.equalsIgnoreCase(calificador.teclaAceptación)
                                && !decision.equalsIgnoreCase(calificador.teclaRechazo));
                        boolean calificacion = decision.equalsIgnoreCase(calificador.teclaAceptación);
                        calificar(j, error, calificacion);
                    }
                }

                if (error) {
                    JOptionPane.showMessageDialog(null,
                            "La frase fue rechazada. " + jugador.nombre + " ha sido eliminado.", "Frase Rechazada",
                            JOptionPane.INFORMATION_MESSAGE);
                    eliminados.add(jugadoresSobrantes.remove(i));
                    i--; // Adjust index after removal
                } else {
                    JOptionPane.showMessageDialog(null, "La frase fue aceptada.", "Frase Aceptada",
                            JOptionPane.INFORMATION_MESSAGE);
                }

                // Mostrar puntajes y tiempos actuales
                StringBuilder sb = new StringBuilder("Puntajes y tiempos actuales:\n");
                jugadoresSobrantes.sort((j1, j2) -> Double.compare(j2.puntuacion, j1.puntuacion)); // Ordenar por
                                                                                                   // puntaje
                                                                                                   // descendente
                for (Jugador j : jugadoresSobrantes) {
                    sb.append(j.nombre + " - Puntaje: " + j.puntuacion + ", Tiempo: " + j.tiempo + "\n");
                }
                JOptionPane.showMessageDialog(null, sb.toString(), "Puntajes y Tiempos",
                        JOptionPane.INFORMATION_MESSAGE);
            }

            // Eliminar jugador con menor puntaje
            eliminarJugadorConMenorPuntaje();

            // Mostrar estadísticas finales y ganador
            JOptionPane.showMessageDialog(null, "El juego ha terminado!", "Fin del Juego",
                    JOptionPane.INFORMATION_MESSAGE);
            StringBuilder sb = new StringBuilder("Resultados finales:\n");
            eliminados.addAll(jugadoresSobrantes); // Añadir los jugadores sobrantes a la lista de eliminados
            eliminados.sort((j1, j2) -> Double.compare(j2.puntuacion, j1.puntuacion)); // Ordenar por puntaje
                                                                                       // descendente
            for (Jugador j : eliminados) {
                sb.append(j.nombre + " - Puntaje: " + j.puntuacion + ", Tiempo: " + j.tiempo + "\n");
            }
            JOptionPane.showMessageDialog(null, sb.toString(), "Resultados Finales", JOptionPane.INFORMATION_MESSAGE);

            // Mostrar el ganador
            if (!eliminados.isEmpty()) {
                Jugador ganador = eliminados.get(0);
                JOptionPane.showMessageDialog(null,
                        "El ganador es: " + ganador.nombre + " con un puntaje de " + ganador.puntuacion,
                        "Ganador", JOptionPane.INFORMATION_MESSAGE);
            }
            // Regresar al menú principal
            MenuJuego.menuPrincipal();
        }
    }

    private void eliminarJugadorConMenorPuntaje() {
        if (this.jugadoresSobrantes.isEmpty())
            return;

        double menorPuntaje = Double.MAX_VALUE;
        int id = -1;
        for (int i = 0; i < this.jugadoresSobrantes.size(); i++) {
            if (this.jugadoresSobrantes.get(i).puntuacion < menorPuntaje) {
                menorPuntaje = this.jugadoresSobrantes.get(i).puntuacion;
                id = i;
            }
        }

        if (id != -1) {
            JOptionPane.showMessageDialog(null, "Se eliminó al jugador: " + this.jugadoresSobrantes.get(id).nombre
                    + " por tener el menor puntaje...", "Jugador Eliminado", JOptionPane.INFORMATION_MESSAGE);
            this.jugadoresSobrantes.remove(id);
        }
    }

    // Método dado de baja
    public void equivocacion(String[] frase, String mensaje1, String mensaje2) {
        String ultimaPalabra = frase[frase.length - 1];
        int equivocaciones = 0;
        for (int i = 0; i < this.frase.size(); i++) {
            if (!frase[i].equalsIgnoreCase(this.frase.get(i))) {
                equivocaciones++;
            }
        }
        if (equivocaciones > 0) {
            JOptionPane.showMessageDialog(null, mensaje1, "Error", JOptionPane.ERROR_MESSAGE);
        } else {
            JOptionPane.showMessageDialog(null, mensaje2, "Correcto", JOptionPane.INFORMATION_MESSAGE);
            if (frase.length - 1 == this.frase.size()) {
                this.frase.add(ultimaPalabra);
            }
        }
    }

    // Un jugador en la posición i califica con true o false la frase de otro
    // jugador
    public void calificar(int i, boolean error, boolean calificacion) {
        if (error) {
            if (calificacion) {
                this.jugadoresSobrantes.get(i).puntuar(-0.5);
            } else {
                this.jugadoresSobrantes.get(i).puntuar(0.5);
            }
        } else {
            if (calificacion) {
                this.jugadoresSobrantes.get(i).puntuar(-0.5);
            } else {
                this.jugadoresSobrantes.get(i).puntuar(0.5);
            }
        }
    }

    // Comprueba si hay errores en la frase escrita por un jugador
    public boolean comprobarError(String[] frase, int jugador) {
        if ((frase.length) - this.frase.size() > 1) {
            return true;
        } else if ((frase.length) < this.frase.size()) {
            return true;
        } else if ((frase.length) == this.frase.size()) {
            return true;
        } else {
            if (this.frase.isEmpty()) {
                String ultimaPalabra = frase[frase.length - 1];
                this.frase.add(ultimaPalabra);
                this.jugadoresSobrantes.get(jugador).puntuar(1);
                return false;
            } else {
                int equivocaciones = 0;
                for (int i = 0; i < this.frase.size(); i++) {
                    if (!frase[i].equalsIgnoreCase(this.frase.get(i))) {
                        equivocaciones++;
                    }
                }
                if (equivocaciones > 0) {
                    return true;
                } else {
                    this.frase.add(frase[frase.length - 1]);
                    this.jugadoresSobrantes.get(jugador).puntuar(1);
                    return false;
                }
            }
        }
    }
}
    </code></pre>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MenuJuego.java</title>
    <style>
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, "Courier New", monospace;
        }
    </style>
</head>
<body>
    <h1>MenuJuego.java</h1>
    <pre><code>
package com.proyecto;

import javax.swing.JOptionPane;

public class MenuJuego {
    static Juego juego; // Es la clase gestor del juego

    // Constructor, inicializa el gestor del juego
    public MenuJuego(Juego juego) {
        MenuJuego.juego = juego;
    }

    // CLI para registrar un nuevo jugador
    // luego de registrar al jugador muestra todos los jugadores registrados
    public static void registrarJugador() {
        String nombre = JOptionPane.showInputDialog("Nombre del jugador:");
        while (nombre == null || nombre.trim().isEmpty()) {
            JOptionPane.showMessageDialog(null, "El nombre no puede estar vacío. Inténtelo de nuevo.", "Error",
                    JOptionPane.ERROR_MESSAGE);
            nombre = JOptionPane.showInputDialog("Nombre del jugador:");
        }

        String teclaA = JOptionPane.showInputDialog("Tecla de aceptación:");
        while (teclaA == null || teclaA.trim().isEmpty()) {
            JOptionPane.showMessageDialog(null, "La tecla de aceptación no puede estar vacía. Inténtelo de nuevo.",
                    "Error", JOptionPane.ERROR_MESSAGE);
            teclaA = JOptionPane.showInputDialog("Tecla de aceptación:");
        }

        String teclaR = JOptionPane.showInputDialog("Tecla de rechazo:");
        while (teclaR == null || teclaR.trim().isEmpty()) {
            JOptionPane.showMessageDialog(null, "La tecla de rechazo no puede estar vacía. Inténtelo de nuevo.",
                    "Error", JOptionPane.ERROR_MESSAGE);
            teclaR = JOptionPane.showInputDialog("Tecla de rechazo:");
        }

        if (MenuJuego.juego.agregarJugador(new Jugador(nombre, teclaA, teclaR))) {
            JOptionPane.showMessageDialog(null, "Jugador registrado con éxito!!");
        } else {
            JOptionPane.showMessageDialog(null, "No se pudo registrar el jugador", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    public static void editarJugador(int op) {
        if (op < MenuJuego.juego.jugadores.size() && op >= 0) {
            String nombre = JOptionPane.showInputDialog("Nombre del jugador:");
            String teclaA = JOptionPane.showInputDialog("Tecla de aceptación:");
            String teclaR = JOptionPane.showInputDialog("Tecla de rechazo:");
            MenuJuego.juego.jugadores.get(op).nombre = nombre;
            MenuJuego.juego.jugadores.get(op).teclaAceptación = teclaA;
            MenuJuego.juego.jugadores.get(op).teclaRechazo = teclaR;
            JOptionPane.showMessageDialog(null, "Jugador actualizado con éxito!!");
            MenuJuego.juego.imprimirJugadores();
        } else {
            JOptionPane.showMessageDialog(null, "No se puede editar jugador fuera de rango", "Error",
                    JOptionPane.ERROR_MESSAGE);
        }
    }

    private static void eliminarJugador(int op) {
        if (op < MenuJuego.juego.jugadores.size() && op >= 0) {
            MenuJuego.juego.jugadores.remove(op);
            JOptionPane.showMessageDialog(null, "Jugador eliminado con éxito!!");
        } else {
            JOptionPane.showMessageDialog(null, "No se puede eliminar jugador fuera de rango", "Error",
                    JOptionPane.ERROR_MESSAGE);
        }
    }

    // Menu principal
    // opción 1 lleva al menú de registro de jugadores
    // opción 2 inicia el juego
    public static void menuPrincipal() {
        int opcion = 0;
        do {
            String input = JOptionPane.showInputDialog(
                    "**************************************************\n" +
                            "JUEGO DE LA FRASE INTERMINABLE\n" +
                            "**************************************************\n" +
                            "1.- Jugadores\n" +
                            "2.- Iniciar nuevo juego\n" +
                            "3.- Salir\n" +
                            "Por favor, seleccione una opción (1-3):");
            try {
                opcion = Integer.parseInt(input);
            } catch (NumberFormatException e) {
                JOptionPane.showMessageDialog(null, "¡Cuidado! Solo puedes insertar números.", "Error",
                        JOptionPane.ERROR_MESSAGE);
                continue; // Volver a pedir la opción sin realizar ninguna acción
            }
            switch (opcion) {
                case 1:
                    menuRegistro();
                    break;
                case 2:
                    verificarJugadores();
                    break;
                case 3:
                    JOptionPane.showMessageDialog(null, "Hasta pronto!!");
                    break;
                default:
                    JOptionPane.showMessageDialog(null, "Opción no válida. Por favor, seleccione una opción (1-3).",
                            "Error",
                            JOptionPane.ERROR_MESSAGE);
                    break;
            }
        } while (opcion != 3);
    }

    // Método para verificar si hay dos o más jugadores para iniciar el juego
    public static void verificarJugadores() {
        if (MenuJuego.juego.jugadores.size() > 1) {
            MenuJuego.juego.iniciarJuego();
        } else {
            JOptionPane.showMessageDialog(null, "No hay suficiente cantidad de jugadores para comenzar el juego",
                    "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    // Menu de registro de jugadores
    // opción 1 para registrar un nuevo jugador
    // opción 2 para ver los jugadores que se encuentran registrados
    public static void menuRegistro() {
        int opcion = 0;
        do {
            String input = JOptionPane.showInputDialog(
                    "*******************************************\n" +
                            "MENU REGISTRO JUGADORES\n" +
                            "*******************************************\n" +
                            "1.- Registrar jugador\n" +
                            "2.- Jugadores registrados\n" +
                            "3.- Editar jugador\n" +
                            "4.- Eliminar jugador\n" +
                            "5.- Salir\n" +
                            "Por favor, seleccione una opción (1-5):");
            try {
                opcion = Integer.parseInt(input);
            } catch (NumberFormatException e) {
                JOptionPane.showMessageDialog(null, "¡Cuidado! Solo puedes insertar números.", "Error",
                        JOptionPane.ERROR_MESSAGE);
                continue; // Volver a pedir la opción sin realizar ninguna acción
            }
            switch (opcion) {
                case 1:
                    registrarJugador();
                    break;
                case 2:
                    if (MenuJuego.juego.jugadores.isEmpty()) {
                        JOptionPane.showMessageDialog(null, "No hay jugadores registrados.", "Información",
                                JOptionPane.INFORMATION_MESSAGE);
                    } else {
                        MenuJuego.juego.imprimirJugadores();
                    }
                    break;
                case 3:
                    if (MenuJuego.juego.jugadores.isEmpty()) {
                        JOptionPane.showMessageDialog(null, "No hay jugadores registrados.", "Información",
                                JOptionPane.INFORMATION_MESSAGE);
                    } else {
                        MenuJuego.juego.imprimirJugadores();
                        input = JOptionPane.showInputDialog(
                                "Seleccione jugador a editar (1-" + MenuJuego.juego.jugadores.size() + "):");
                        try {
                            opcion = Integer.parseInt(input);
                        } catch (NumberFormatException e) {
                            JOptionPane.showMessageDialog(null, "¡Cuidado! Solo puedes insertar números.", "Error",
                                    JOptionPane.ERROR_MESSAGE);
                            continue; // Volver a pedir la opción sin realizar ninguna acción
                        }
                        editarJugador(opcion - 1);
                    }
                    break;
                case 4:
                    if (MenuJuego.juego.jugadores.isEmpty()) {
                        JOptionPane.showMessageDialog(null, "No hay jugadores registrados.", "Información",
                                JOptionPane.INFORMATION_MESSAGE);
                    } else {
                        MenuJuego.juego.imprimirJugadores();
                        input = JOptionPane.showInputDialog(
                                "Seleccione jugador a eliminar (1-" + MenuJuego.juego.jugadores.size() + "):");
                        try {
                            opcion = Integer.parseInt(input);
                        } catch (NumberFormatException e) {
                            JOptionPane.showMessageDialog(null, "¡Cuidado! Solo puedes insertar números.", "Error",
                                    JOptionPane.ERROR_MESSAGE);
                            continue; // Volver a pedir la opción sin realizar ninguna acción
                        }
                        eliminarJugador(opcion - 1);
                    }
                    break;
                case 5:
                    return; // Salir del menú de registro
                default:
                    JOptionPane.showMessageDialog(null, "Opción no válida. Por favor, seleccione una opción (1-5).",
                            "Error",
                            JOptionPane.ERROR_MESSAGE);
                    break;
            }
        } while (opcion != 5);
    }
}
    </code></pre>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App.java</title>
    <style>
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, "Courier New", monospace;
        }
    </style>
</head>
<body>
    <h1>App.java</h1>
    <pre><code>
package com.proyecto;

public class App {
    public static void main(String[] args) {
        // Aplicacion llama al menu principal y recibe de parametro un GestorJuego
        MenuJuego menu = new MenuJuego(new Juego());
        menu.menuPrincipal();
    }
}
    </code></pre>
</body>
</html>
